<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" href="favicon-32.png" sizes="32x32">
  <link rel="icon" href="favicon-128.png" sizes="128x128">
  <link rel="icon" href="favicon-167.png" sizes="167x167">
  <link rel="icon" href="favicon-192.png" sizes="192x192">

  <link rel="stylesheet" href="css/main.css?v=9584d2b6">
  <link rel="stylesheet" href="css/apple-glass-theme.css">
  <link rel="stylesheet" href="css/widgets.css?v=7d85fcde">

  <script src="jquery/jquery-3.5.1.slim.min.js"></script>

  <!-- <script src="ammo/ammo-20210414.js"></script> -->
  <script src="ammo/ammo-20210414.wasm.js"></script>

  <script src="babylon/4.2.1/babylon.js"></script>
  <script src="babylon/4.2.1/babylonjs.loaders.min.js"></script>
  <script src="pep/0.4.3/pep.min.js"></script>

  <script src="js/msg.js"></script>
  <script src="js/common/widgets.js"></script>

  <title>ATLAS Sim World Builder</title>
  <script src="js/theme-toggle.js"></script>
</head>

<body>
  <header>
    <div class="appTitle">ATLAS Sim World Builder</div>
    <button class="theme-toggle" id="themeToggle" title="Toggle Dark/Light Theme">◐</button>
  </header>

  <main>
    <nav>
      <ul class="panelTabs">
        <li id="navWorld" class="active">World</li>
      </ul>
      <div class="menuBar">
        <div class="menuItem fileMenu">File</div>
        <div class="menuItem worldMenu">World</div>
        <div class="menuItem snapMenu">Snap</div>
      </div>
      <button class="helperToggle" id="helperToggle" type="button" aria-pressed="false">Hide tips</button>
    </nav>
    <div class="panels">
      <div class="panel active" aria-labelledby="navWorld">
        <canvas id="renderCanvas" touch-action="none"></canvas>
        <div class="worldInfo hide"></div>
        <div class="objectsWindow">
          <div class="buttons">
            <div class="addObject">Add</div>
            <div class="cloneObject">Clone</div>
            <div class="deleteObject">Delete</div>
          </div>
          <div class="objectsList"></div>
          <div class="buttons">
            <div class="undo">Undo</div>
          </div>
        </div>
        <div class="objectID"></div>
        <div class="settingsWindow">
          <div class="settingsArea"></div>
        </div>
        <div class="ruler closed" style="top: 1em; left: 10em;">
          <div class="icon">
            <span class="icon-ruler"></span>
          </div>
          <div class="measurements">
            <table>
              <tr>
                <td class="x">X:</td>
                <td class="y">Y:</td>
                <td class="alt">Alt:</td>
              </tr>
              <tr>
                <td class="dist" colspan="2">Distance:</td>
                <td class="angle">Angle:</td>
              </tr>
            </table>
          </div>
        </div>
        <div class="helperCard block-help" data-tip-id="builder-help">
          <button class="helperClose" type="button" aria-label="Close tip">×</button>
          <div class="helperTitle">World Builder tips</div>
          <p>Use Add to drop a new object, then drag it in the scene to move it. Clone duplicates the selected object; Delete removes it. Snap menu controls grid snapping; Undo rolls back the last change. The ruler shows distances and angles to plan layouts.</p>
        </div>
      </div>
    </div>
  </main>

  <script src="js/worlds/World_Base.js?v=9f07f537"></script>
  <script src="js/worlds/world_Custom.js?v=a56a2eb0"></script>
  <script src="js/robotComponents.js?v=c851c5ff"></script>
  <script src="js/robotTemplates.js?v=b318d615"></script>
  <script src="js/Wheel.js?v=bb27211a"></script>
  <script src="js/Robot.js?v=742ebc7e"></script>
  <script>
    var robots = [];

    var robot = new Robot();
    robot.options = JSON.parse(JSON.stringify(robotTemplates[0]));
    robot.player = 'single';
    robots.push(robot);
  </script>
  <script src="js/babylon.js?v=6061094f"></script>
  <script src="js/simPanel.js?v=37d4fdb5"></script>
  <script src="js/builtInImages.js?v=e885f8db"></script>
  <script src="js/builtInModels.js?v=82f73098"></script>
  <script src="js/GenConfig.js?v=3007e163"></script>
  <script src="js/builder.js?v=a8d24858"></script>

  <script>
    (function(){
      const toggle = document.getElementById('helperToggle');
      const cards = Array.from(document.querySelectorAll('.helperCard'));
      if (!toggle || cards.length === 0) {
        return;
      }

      const KEY = 'atlasTipsHidden';
      const KEY_CLOSED = 'atlasTipsClosed';

      function loadClosed() {
        try {
          const val = localStorage.getItem(KEY_CLOSED);
          if (!val) return new Set();
          return new Set(JSON.parse(val));
        } catch (e) {
          return new Set();
        }
      }

      let closedSet = loadClosed();

      function saveClosed() {
        localStorage.setItem(KEY_CLOSED, JSON.stringify(Array.from(closedSet)));
      }

      function apply(hidden) {
        cards.forEach((c) => {
          const id = c.dataset.tipId || c.className;
          const isClosed = closedSet.has(id);
          c.classList.toggle('hide', hidden || isClosed);
        });
        toggle.textContent = hidden ? 'Show tips' : 'Hide tips';
        toggle.setAttribute('aria-pressed', hidden ? 'true' : 'false');
      }

      const startHidden = localStorage.getItem(KEY) === 'true';
      apply(startHidden);

      toggle.addEventListener('click', () => {
        const next = !cards.some((c) => !c.classList.contains('hide'));
        if (!next) {
          closedSet.clear();
          saveClosed();
        }
        apply(next);
        localStorage.setItem(KEY, next ? 'true' : 'false');
      });

      cards.forEach((c) => {
        const btn = c.querySelector('.helperClose');
        if (!btn) return;
        btn.addEventListener('click', () => {
          const id = c.dataset.tipId || c.className;
          closedSet.add(id);
          saveClosed();
          c.classList.add('hide');
        });
      });
    })();
  </script>

</body>
</html>
