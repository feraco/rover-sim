<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" href="favicon-32.png" sizes="32x32">
  <link rel="icon" href="favicon-128.png" sizes="128x128">
  <link rel="icon" href="favicon-167.png" sizes="167x167">
  <link rel="icon" href="favicon-192.png" sizes="192x192">

  <link rel="stylesheet" href="css/main.css?v=9584d2b6">
  <link rel="stylesheet" href="css/apple-glass-theme.css">
  <link rel="stylesheet" href="css/widgets.css?v=7d85fcde">

  <script src="jquery/jquery-3.5.1.slim.min.js"></script>

  <!-- <script src="ammo/ammo-20210414.js"></script> -->
  <script src="ammo/ammo-20210414.wasm.js"></script>

  <script src="babylon/4.2.1/babylon.js"></script>
  <script src="pep/0.4.3/pep.min.js"></script>

  <script src="js/msg.js"></script>
  <script src="js/common/widgets.js"></script>

  <title>ATLAS Sim Robot Configurator</title>
  <script src="js/theme-toggle.js"></script>
</head>

<body>
  <header>
    <div class="appTitle">ATLAS Sim Robot Configurator</div>
    <input type="text" id="robotName" placeholder="Robot Name">
    <button class="theme-toggle" id="themeToggle" title="Toggle Dark/Light Theme">◐</button>
  </header>

  <main>
    <nav>
      <ul class="panelTabs">
        <li id="navRobot" class="active">Robot</li>
      </ul>
      <div class="menuBar">
        <div class="menuItem fileMenu">File</div>
        <div class="menuItem robotMenu">Robot</div>
        <div class="menuItem snapMenu">Snap</div>
      </div>
      <button class="helperToggle" id="helperToggle" type="button" aria-pressed="false">Hide tips</button>
    </nav>
    <div class="panels">
      <div class="panel active" aria-labelledby="navRobot">
        <canvas id="renderCanvas" touch-action="none"></canvas>
        <div class="componentsWindow">
          <div class="buttons">
            <div class="addComponent">Add</div>
            <div class="deleteComponent">Delete</div>
          </div>
          <div class="componentsList"></div>
          <div class="buttons">
            <div class="undo">Undo</div>
          </div>
        </div>
        <div class="settingsWindow">
          <div class="settingsArea"></div>
        </div>
        <div class="ruler closed" style="top: 1em; left: 10em;">
          <div class="icon">
            <span class="icon-ruler"></span>
          </div>
          <div class="measurements">
            <table>
              <tr>
                <td class="x">X:</td>
                <td class="y">Y:</td>
                <td class="alt">Alt:</td>
              </tr>
              <tr>
                <td class="dist" colspan="2">Distance:</td>
                <td class="angle">Angle:</td>
              </tr>
            </table>
          </div>
        </div>
        <div class="helperCard block-help" data-tip-id="configurator-help">
          <button class="helperClose" type="button" aria-label="Close tip">×</button>
          <div class="helperTitle">Robot Configurator tips</div>
          <p>Add components to the list, then select one to edit its position in the scene. Use Delete to remove, Undo to revert, and Snap to align parts cleanly. The ruler helps you measure sensor offsets and wheel spacing.</p>
        </div>
      </div>
    </div>
  </main>

  <script src="js/worlds/world_Configurator.js?v=70aec4b9"></script>
  <script src="js/robotComponents.js?v=c851c5ff"></script>
  <script src="js/robotTemplates.js?v=b318d615"></script>
  <script src="js/Wheel.js?v=bb27211a"></script>
  <script src="js/Robot.js?v=742ebc7e"></script>
  <script>
    var robots = [];

    var robot = new Robot();
    robot.options = JSON.parse(JSON.stringify(robotTemplates[0]));
    robot.player = 'single';
    robots.push(robot);
  </script>
  <script src="js/babylon.js?v=6061094f"></script>
  <script src="js/simPanel.js?v=37d4fdb5"></script>
  <script src="js/builtInImages.js?v=e885f8db"></script>
  <script src="js/GenConfig.js?v=3007e163"></script>
  <script src="js/configurator.js?v=6a54037c"></script>

  <script>
    (function(){
      const toggle = document.getElementById('helperToggle');
      const cards = Array.from(document.querySelectorAll('.helperCard'));
      if (!toggle || cards.length === 0) {
        return;
      }

      const KEY = 'atlasTipsHidden';
      const KEY_CLOSED = 'atlasTipsClosed';

      function loadClosed() {
        try {
          const val = localStorage.getItem(KEY_CLOSED);
          if (!val) return new Set();
          return new Set(JSON.parse(val));
        } catch (e) {
          return new Set();
        }
      }

      let closedSet = loadClosed();

      function saveClosed() {
        localStorage.setItem(KEY_CLOSED, JSON.stringify(Array.from(closedSet)));
      }

      function apply(hidden) {
        cards.forEach((c) => {
          const id = c.dataset.tipId || c.className;
          const isClosed = closedSet.has(id);
          c.classList.toggle('hide', hidden || isClosed);
        });
        toggle.textContent = hidden ? 'Show tips' : 'Hide tips';
        toggle.setAttribute('aria-pressed', hidden ? 'true' : 'false');
      }

      const startHidden = localStorage.getItem(KEY) === 'true';
      apply(startHidden);

      toggle.addEventListener('click', () => {
        const next = !cards.some((c) => !c.classList.contains('hide'));
        if (!next) {
          closedSet.clear();
          saveClosed();
        }
        apply(next);
        localStorage.setItem(KEY, next ? 'true' : 'false');
      });

      cards.forEach((c) => {
        const btn = c.querySelector('.helperClose');
        if (!btn) return;
        btn.addEventListener('click', () => {
          const id = c.dataset.tipId || c.className;
          closedSet.add(id);
          saveClosed();
          c.classList.add('hide');
        });
      });
    })();
  </script>

</body>
</html>
